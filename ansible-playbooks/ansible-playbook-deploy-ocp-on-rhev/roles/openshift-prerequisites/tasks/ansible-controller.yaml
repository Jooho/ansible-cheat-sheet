---
- set_fact:
    need_repo_list:
       - rhel-7-server-rpms
       - rhel-7-server-ose-{{ocp_version}}-rpms
- shell: subscription-manager repos --list-enabled  |grep 'Repo ID'|awk  '{print $3}'
  register: enabled_repo_list

- name: Disable unneeded repositories
  command: subscription-manager repos --disable='*'
  when: need_repo_list|difference(enabled_repo_list.stdout_lines)|length != 0 

- name: Enable OpenShift repositories
  command: subscription-manager repos --enable="{{item}}"
  with_items:
    - "{{ need_repo_list }}"
  when: need_repo_list|difference(enabled_repo_list.stdout_lines)|length != 0


- name: Install the required rpms
  shell: yum install -y wget git net-tools bind-utils iptables-services bridge-utils bash-completion kexec-tools sos psacct atomic-openshift-utils 

#  package:
#    use: yum
#    name: "{{ item }}"
#    state: latest
#  with_items: ['iptables', 'iptables-services', 'NetworkManager', 'wget', 'git', 'net-tools', 'bind-utils',
#               'iptables-services', 'bridge-utils', 'bash-completion', 'kexec-tools', 'sos', 'psacct',
#               'atomic-openshift-utils', 'atomic-openshift-excluder', 'atomic-openshift-docker-excluder']

- name: Determine if firewalld is installed
  yum:
    name: "firewalld"
    state: present
  register: firewalld_installed

- name: Stop firewalld
  service:
    name: firewalld
    state: stopped
    enabled: false

- name: Start iptables
  service:
    name: iptables
    state: stopped
    enabled: false
